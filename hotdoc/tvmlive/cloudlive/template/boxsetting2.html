<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
	<noscript><meta http-equiv=refresh content="0; url=noscript.html"></noscript>
	<title>盒子列表页</title>
    <link rel="stylesheet" type="text/css" href="css/bf/common.css">
    <link rel="stylesheet" href="css/bf/home.css">
    <link rel="stylesheet" href="css/bf/bootstrap.min.css">
</head>

<body>
    <div class="wrapper">
        <div class="main">
            <div class="sidebar">
                <div class=" side-userinfo">
                    
                </div>
                <ul>
                    <li class="nowPage">
                        <a class="side-tag" href="">
                            <img src="images/bf/home.png">
                            <span>主页</span>
                            <div class="clear"></div>
                        </a>
                        <img class="side-point" src="images/bf/point.png">
                    </li>
                    <li>
                        <a class="side-tag" href="">
                            <img src="images/bf/project.png">
                            <span class="msgNum">4</span>
                            <span>消息</span>
                            <div class="clear"></div>
                        </a>
                        <img class="side-point" src="images/bf/point.png">
                    </li>
                </ul>
            </div>
            <div class="content">
                <div class="header">
                    
                </div>
                <div class="show">
                    <!-- 盒子设置-->
                    <div class="boxSet">
                        <div class="boxSet-up">
                            <div class="boxSet-preview">
                                <img src="<?php print $this->imageurl?>" alt="预览">
                            </div>
                            <div class="boxSet-action">
                                <div class="input-group">
                                    <input type="text" id="codename" class="form-control input-lg" placeholder="修改名称">
									<input type="hidden" id="codeid" value="<?php print $this->boxid?>">
                                    <span class="input-group-btn">
                                    <button id="editbut" class="btn  btn-danger btn-lg cname" type="button">确定</button>
                                    </span>
                                </div>
                                <div class="boxInfo">
                                    <div class="boxName">
                                        <span><?php print $this->boxname?>
                                        </span>
                                    </div>
                                    <span>|</span>
                                    <div class="boxStatus">
										<?php if($this->online){?>
                                        <img src="images/bf/j.png">
                                        <span>在线</span>
										<?php }else{?>
										<img src="images/bf/x.png">
                                        <span>离线</span>
										<?php }?>
                                    </div>
                                </div>
                                <button class="btn btn-lg btn-black unBind">解除绑定</button>
                            </div>
                            <div class="clear"></div>
                        </div>
                        <div class="boxSet-down">
                            <div class="form-group">
                                <input type="text" id="fe_text" class="form-control input-lg" value="<?php print $this->liveurl?>" readonly="readonly" placeholder="网页直播路径">
                                <span class="glyphicon glyphicon-qrcode boxSet-icon  boxSet-qr" aria-hidden="true">
                                <img src="?m=5127&id=<?php print $this->boxid?>&type=1" style="position: absolute;top: -14px;right: 27px;">
                                </span>
                                <span class="temp-l0">|</span>
                                <span class="glyphicon glyphicon-duplicate boxSet-icon  boxSet-copy" aria-hidden="true"><span>复制链接</span></span>
                                <span class="temp-l1">|</span>
                                <span class="glyphicon glyphicon-picture boxSet-icon  boxSet-upload" aria-hidden="true"><span>上传图片</span></span>
                                <span class="temp-l2">|</span>
                                <span class="glyphicon glyphicon-eye-open boxSet-icon  boxSet-watch" aria-hidden="true"><span>预览直播</span></span>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control input-lg"  value="<?php print $this->liveurl?>" readonly="readonly"  aria-describedby="inputWarning2Status" placeholder="微信直播路径">
                                <span class="glyphicon glyphicon-qrcode boxSet-icon boxSet-qr" aria-hidden="true">
                                	<img src="?m=5127&id=<?php print $this->boxid?>&type=1" style="position: absolute;top: -14px;right: 27px;">
                                </span>
                                <span class="temp-l0">|</span>
                                <span class="glyphicon glyphicon-duplicate boxSet-icon boxSet-copy" aria-hidden="true"><span>复制链接</span></span>
                                <span class="temp-l1">|</span>
                                <span class="glyphicon glyphicon-picture boxSet-icon boxSet-upload" aria-hidden="true"><span>上传图片</span></span>
                                <span class="temp-l2">|</span>
                                <span class="glyphicon glyphicon-eye-open  boxSet-icon boxSet-watch" aria-hidden="true"><span>预览直播</span></span>
                            </div>
                        </div>
                    </div>
                    <!-- 盒子设置 end-->
                </div>
            </div>
        </div>
        <!-- 弹窗 -->
        <div class="TC">
            <div class="opacity8">
                <!-- 萌版 -->
            </div>
            <div class="skipto">
                <!-- 3秒跳转 -->
            </div>
            <!-- 上传图片 -->
            <div class="tc-uploadFile">
                <div class="tc-close">
                    <img src="images/bf/close.png" alt="">
                </div>
                <div style="text-align: center;line-height: 50px;margin-bottom: 50px;">
                    <p style="font-size:40px;padding: 0;margin: 0">上传直播宣传图片</p>
                    <span style="color:#00a0e9;font-size: 16px;">支持JPG、JPEG、PNG格式，大小限制1M以内</span>
                </div>
                <div class="input-group">
				<form  enctype="multipart/form-data" id="exeForm" action="" method="post" target="upload_frame">
					<input type="hidden" name="id" value="<?php print $this->boxid?>">
                    <input type="file" name="file" onchange="previewImage(this)" id="uploadfile" class="form-control input-lg" placeholder="您未上传任何文件" >
				</form>
				<iframe name='upload_frame' id="upload_frame" style='display:none'></iframe>
                </div>
                <div class="tc-uploadFile-preview" id="preview">
				<img src="images/bf/default.png" alt="预览">
                </div>
                <p style="text-align: center;">
                    <button class="btn btn-danger btn-lg tc-uploadFile-yes" type="btn"> 确 定 </button>
                </p>
            </div>
            <div class="successTo">
              <div class="tc-close" style="right: 70px;">
                    <img src="images/bf/close.png" alt="">
                </div>
            	<h2 class="successTo-msg">上传图片成功!</h2>
            	<p>3S后跳转至您的云直播</p>
            </div>
        </div>
    </div>
    <footer></footer>
    <script type="text/javascript" src="js/lib/jquery-1.12.3.min.js"></script>
	<script type="text/javascript" src="js/lib/jquery.zclip.min.js"></script>
	<script type="text/javascript" src="js/bf/common.js"></script>
    <script type="text/javascript" src="js/bf/home.js"></script>
	<script language="javascript">
	$(function(){
	//点击复制链接

$(".boxSet-copy").zclip({
    path:"js/lib/ZeroClipboard.swf",
    copy:function(){
      return  $(this).closest('.form-group').find("input").val();
    },
    afterCopy:function(){
        alert("链接已复制！");
    }
});


	

	function previewImage(file)
        {
          var MAXWIDTH  = 252; 
          var MAXHEIGHT = 252;
          var div = document.getElementById('preview');
          if (file.files && file.files[0])
          {
              div.innerHTML ='<img id=imghead>';
              var img = document.getElementById('imghead');
              img.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width  =  rect.width;
                img.height =  rect.height;
//                 img.style.marginLeft = rect.left+'px';
                img.style.marginTop = rect.top+'px';
              }
              var reader = new FileReader();
              reader.onload = function(evt){img.src = evt.target.result;}
              reader.readAsDataURL(file.files[0]);
          }
          else //兼容IE
          {
            var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            var src = document.selection.createRange().text;
            div.innerHTML = '<img id=imghead>';
            var img = document.getElementById('imghead');
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
            div.innerHTML = "<div id=divhead style='width:"+rect.width+"px;height:"+rect.height+"px;margin-top:"+rect.top+"px;"+sFilter+src+"\"'></div>";
          }
        }
        function clacImgZoomParam( maxWidth, maxHeight, width, height ){
            var param = {top:0, left:0, width:width, height:height};
            if( width>maxWidth || height>maxHeight )
            {
                rateWidth = width / maxWidth;
                rateHeight = height / maxHeight;
                  
                if( rateWidth > rateHeight )
                {
                    param.width =  maxWidth;
                    param.height = Math.round(height / rateWidth);
                }else
                {
                    param.width = Math.round(width / rateHeight);
                    param.height = maxHeight;
                }
            }
              
            param.left = Math.round((maxWidth - param.width) / 2);
            param.top = Math.round((maxHeight - param.height) / 2);
            return param;
	    }
			$('#editbut').click(function(){		
			var url = '?m=5124';
			var name = $("#codename").val();
			if(name.trim()==""){
				return;
			}
			var boxid = $("#codeid").val();
			if(boxid.trim()==""){
				return;
			}else if(!checknumber(boxid)){
				return;
			}

			$.post(url,{'name':name,'id':boxid},function(data){
				var msg = data.msg.replace("\\n","<br/>");			
				if(data.status){
					$("#codename").val('');
					$(".boxName").find('span').text(data.data);
				}
			},'json');
		});
		$(".unBind").on("click", function() {
			if(confirm("确定删除直播设备？")){
				var url = '?m=5125';
				
				var boxid = $("#codeid").val();
				if(boxid.trim()==""){
					return;
				}else if(!checknumber(boxid)){
					return;
				}

				$.post(url,{'name':name,'id':boxid},function(data){
					var msg = data.msg.replace("\\n","<br/>");			
					if(data.status){
						location.href="?m=5101";
					}
				},'json');
			}
		});
})
	</script>
</body>

</html>
